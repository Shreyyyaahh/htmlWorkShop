<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Immersive Universe</title>
  <meta name="description" content="A mind‑blowing, immersive universe page with parallax nebulae, twinkling stars, constellations, and warp drive." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="universe.css">
   
</head>
<body>
  <!-- Stars backdrop (Canvas) -->
  <canvas id="stars" class="layer" aria-hidden="true"></canvas>

  <!-- CSS twinkles + nebula fog -->
  <div class="layer twinkles" aria-hidden="true"></div>
  <div class="layer nebula" aria-hidden="true"></div>

  <!-- Shooting comets layer -->
  <canvas id="comets" aria-hidden="true"></canvas>

  <!-- 3D Parallax Set -->
  <div class="tilt">
    <div class="parallax" id="parallax">

      <div class="p planet" style="--depth:60">
        <svg viewBox="0 0 600 600" width="100%" height="100%" aria-label="Gas giant planet">
          <defs>
            <radialGradient id="g0" cx="50%" cy="40%" r="60%">
              <stop offset="0%" stop-color="#ffe8f7"/>
              <stop offset="50%" stop-color="#c7b8ff"/>
              <stop offset="100%" stop-color="#4f46e5"/>
            </radialGradient>
            <filter id="noisey" x="-20%" y="-20%" width="140%" height="140%">
              <feTurbulence type="fractalNoise" baseFrequency=".6" numOctaves="4" seed="7"/>
              <feColorMatrix type="saturate" values="0.4"/>
              <feBlend mode="overlay" in2="SourceGraphic"/>
            </filter>
          </defs>
          <circle cx="300" cy="300" r="260" fill="url(#g0)" filter="url(#noisey)"/>
          <!-- Polar glow -->
          <circle cx="230" cy="210" r="130" fill="rgba(255,255,255,.2)"/>
        </svg>
      </div>

      <div class="p rings" style="--depth:100">
        <svg viewBox="0 0 700 400" width="560" height="320" aria-label="Planet rings">
          <defs>
            <linearGradient id="rg" x1="0%" x2="100%">
              <stop offset="0%" stop-color="#7cf7ff" />
              <stop offset="50%" stop-color="#a78bfa" />
              <stop offset="100%" stop-color="#fb37a8" />
            </linearGradient>
          </defs>
          <g opacity="0.85">
            <ellipse cx="260" cy="220" rx="300" ry="80" fill="none" stroke="url(#rg)" stroke-width="10"/>
            <ellipse cx="260" cy="220" rx="250" ry="65" fill="none" stroke="url(#rg)" stroke-width="6"/>
            <ellipse cx="260" cy="220" rx="200" ry="52" fill="none" stroke="url(#rg)" stroke-width="4"/>
          </g>
        </svg>
      </div>

      <div class="p ship" style="--depth:140">
        <svg viewBox="0 0 256 128" width="100%" height="100%" aria-label="Explorer ship silhouette">
          <defs>
            <linearGradient id="thr" x1="0%" x2="100%">
              <stop offset="0%" stop-color="#ffe6a3"/>
              <stop offset="100%" stop-color="#7cf7ff"/>
            </linearGradient>
          </defs>
          <g filter="drop-shadow(0 6px 20px rgba(124,247,255,.4))">
            <path d="M10 78 Q70 30 160 52 L246 64 L160 76 Q70 98 10 50 Z" fill="#cde9ff" opacity=".85"/>
            <path d="M236 64 L256 64" stroke="url(#thr)" stroke-width="8" stroke-linecap="round">
              <animate attributeName="x2" values="256; 240; 256" dur="2.2s" repeatCount="indefinite"/>
            </path>
          </g>
        </svg>
      </div>

    </div>
  </div>

  <!-- Constellation lines (dynamic) -->
  <div class="constellation" aria-hidden="true">
    <svg id="constellationSVG" xmlns="http://www.w3.org/2000/svg"></svg>
  </div>

  <!-- HUD -->
  <div class="hud">
    <header>
      <div class="badge">DEEP SPACE • LIVE</div>
    </header>

    <div style="padding: clamp(12px, 2vw, 28px);">
      <h1 class="title">Dive into the <span style="color:var(--neon)">Infinite</span></h1>
      <p class="subtitle">A living starfield with nebulae, constellations, comets, parallax planets and a warp drive. Move your mouse or tilt your phone. Click “Warp” to punch through spacetime.</p>
    </div>

    <div class="controls">
      <button class="btn" id="warpBtn">WARP</button>
      <button class="btn secondary" id="constBtn">DRAW CONSTELLATION</button>
      <button class="btn ghost" id="resetBtn">RESET</button>
    </div>

    <div class="card" id="card">
      <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 3v18M3 12h18"/>
        </svg>
        <strong style="letter-spacing:.08em">Spatial Velocity</strong>
      </div>
      <div class="meter"><div class="fill" id="meterFill"></div></div>
      <div style="display:flex; gap:12px; margin-top:12px; font-size:12px; opacity:.85">
        <div>Stars: <span id="starCount">0</span></div>
        <div>FPS: <span id="fps">--</span></div>
      </div>
    </div>
  </div>

  <!-- Cursor -->
  <div class="cursor" id="cursor" aria-hidden="true"></div>

  <footer>Made with ♥ for explorers — <a href="#" id="saveShot">capture</a></footer>

  <script>
    // ===== Helpers =====
    const clamp=(n,min,max)=>Math.max(min,Math.min(max,n));

    // ===== Responsive Canvases =====
    const starsCanvas = document.getElementById('stars');
    const cometsCanvas = document.getElementById('comets');
    const sctx = starsCanvas.getContext('2d');
    const cctx = cometsCanvas.getContext('2d');

    let W,H, DPR = Math.min(window.devicePixelRatio||1, 2);
    function resize(){
      W = starsCanvas.width = cometsCanvas.width = Math.floor(innerWidth * DPR);
      H = starsCanvas.height = cometsCanvas.height = Math.floor(innerHeight * DPR);
      starsCanvas.style.width = cometsCanvas.style.width = innerWidth + 'px';
      starsCanvas.style.height = cometsCanvas.style.height = innerHeight + 'px';
    }
    addEventListener('resize', resize, {passive:true});
    resize();

    // ===== Starfield (parallax depths) =====
    const layers = [
      {count: 350, speed: .02, size:[.5,1.6], color:'rgba(255,255,255,0.9)'},
      {count: 250, speed: .05, size:[.6,1.8], color:'rgba(124,247,255,0.9)'},
      {count: 160, speed: .09, size:[.8,2.2], color:'rgba(255,209,102,0.9)'}
    ];

    const stars = [];
    function spawnStar(layer){
      const r = (min,max)=>min+Math.random()*(max-min);
      return {
        x: Math.random()*W,
        y: Math.random()*H,
        z: r(0.5, 1.2),
        s: r(layer.size[0], layer.size[1]),
        vx: 0, vy: 0,
        c: layer.color,
        layer
      };
    }

    layers.forEach(l=>{ for(let i=0;i<l.count;i++) stars.push(spawnStar(l)); });

    let warp = 0; // 0..1
    let mouseX=0, mouseY=0; let targetX=0, targetY=0;

    addEventListener('mousemove', e=>{targetX = (e.clientX/innerWidth - .5); targetY = (e.clientY/innerHeight - .5); cursorMove(e)});
    addEventListener('touchmove', e=>{const t=e.touches[0]; if(!t) return; targetX=(t.clientX/innerWidth-.5); targetY=(t.clientY/innerHeight-.5);}, {passive:true});

    // Device tilt
    addEventListener('deviceorientation', e=>{
      const gamma = clamp((e.gamma||0)/45, -1, 1); // left-right
      const beta = clamp((e.beta||0-45)/45, -1, 1); // front-back
      targetX = gamma*.6; targetY = beta*.6;
    });

    // Parallax tilt for SVG layers
    const parallax = document.getElementById('parallax');

    function renderStars(dt){
      sctx.clearRect(0,0,W,H);
      // Interpolate mouse
      mouseX += (targetX - mouseX)*.06; mouseY += (targetY - mouseY)*.06;

      // Tilt scene
      const tiltX = mouseY * 10; // deg
      const tiltY = -mouseX * 10;
      parallax.style.transform = `rotateX(${tiltX}deg) rotateY(${tiltY}deg)`;

      for(const st of stars){
        // Parallax drift based on mouse and depth
        const mpx = mouseX * 40 * st.layer.speed;
        const mpy = mouseY * 40 * st.layer.speed;

        // Warp speed forward motion
        const spd = (st.layer.speed * 20) * (1 + warp*25) * dt;
        st.x -= spd + mpx; st.y += mpy*0.3; // angled drift

        // Wrap
        if(st.x < -5) { st.x = W+5; st.y = Math.random()*H; }

        // Draw
        sctx.beginPath();
        sctx.fillStyle = st.c;
        const r = st.s * DPR * (1 + warp*2*st.z);
        sctx.arc(st.x, st.y, r, 0, Math.PI*2);
        sctx.fill();

        // Simple streaks during warp
        if(warp>0.2){
          sctx.globalAlpha = clamp(warp*1.2,0,1);
          sctx.beginPath();
          sctx.strokeStyle = st.c;
          sctx.moveTo(st.x + 2*r, st.y);
          sctx.lineTo(st.x + 2*r + 12*warp*st.layer.speed*DPR*10, st.y);
          sctx.stroke();
          sctx.globalAlpha=1;
        }
      }
    }

    // ===== Shooting comets =====
    const comets=[];
    function spawnComet(){
      const y = Math.random()*H*0.7 + H*0.1;
      comets.push({x: W+50, y, vx: -(2+Math.random()*4)*DPR, life: 1});
    }
    setInterval(()=>{ if(Math.random()<.5) spawnComet(); }, 2000);

    function renderComets(dt){
      cctx.clearRect(0,0,W,H);
      for(const c of comets){
        c.x += c.vx * (1+warp*10) * dt*60; c.life -= 0.003*dt*(1+warp*6);
        if(c.x < -200 || c.life<=0){ comets.splice(comets.indexOf(c),1); continue; }

        const len = 120 * DPR * (1+warp*3);
        const grad = cctx.createLinearGradient(c.x, c.y, c.x+len, c.y);
        grad.addColorStop(0, 'rgba(255,255,255,.9)');
        grad.addColorStop(1, 'rgba(124,247,255,0)');
        cctx.strokeStyle = grad; cctx.lineWidth = 2*DPR;
        cctx.beginPath(); cctx.moveTo(c.x, c.y); cctx.lineTo(c.x+len, c.y); cctx.stroke();
      }
    }

    // ===== Constellations =====
    const constBtn = document.getElementById('constBtn');
    const resetBtn = document.getElementById('resetBtn');
    const svg = document.getElementById('constellationSVG');
    let drawing=false; let points=[];
    constBtn.addEventListener('click', ()=>{drawing=true; points=[]; svg.innerHTML='';});
    resetBtn.addEventListener('click', ()=>{drawing=false; points=[]; svg.innerHTML=''; warp=0; updateMeter();});

    function addLine(a,b){
      const line=document.createElementNS('http://www.w3.org/2000/svg','line');
      line.setAttribute('x1',a.x); line.setAttribute('y1',a.y); line.setAttribute('x2',b.x); line.setAttribute('y2',b.y);
      svg.appendChild(line);
    }

    addEventListener('click', e=>{
      if(!drawing) return;
      const x = e.clientX; const y = e.clientY;
      points.push({x,y});
      if(points.length>1) addLine(points[points.length-2], points[points.length-1]);
    });

    // ===== Cursor embellishment =====
    const cursor = document.getElementById('cursor');
    function cursorMove(e){
      cursor.style.transform = `translate(${e.clientX-11}px, ${e.clientY-11}px)`;
    }

    // ===== HUD Meter & FPS =====
    const meter = document.getElementById('meterFill');
    const starCountEl = document.getElementById('starCount');
    const fpsEl = document.getElementById('fps');
    starCountEl.textContent = stars.length.toString();

    function updateMeter(){ meter.style.width = `${Math.floor(warp*100)}%`; }

    let last=performance.now(); let frames=0; let lastFpsTick=performance.now();

    function loop(ts){
      const dt = (ts-last)/16.666; last=ts; frames++;
      if(ts-lastFpsTick>500){ fpsEl.textContent = Math.round((frames*1000)/(ts-lastFpsTick)); frames=0; lastFpsTick=ts; }
      renderStars(dt);
      renderComets(dt);
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);

    // ===== Warp Drive =====
    const warpBtn = document.getElementById('warpBtn');
    let warpActive=false; let warpT=0;
    function setWarp(on){ warpActive=on; }
    warpBtn.addEventListener('click', ()=> setWarp(!warpActive));

    function tickWarp(){
      const target = warpActive? 1 : 0;
      warp += (target - warp) * 0.05;
      updateMeter();
      requestAnimationFrame(tickWarp);
    }
    tickWarp();

    // Save screenshot
    document.getElementById('saveShot').addEventListener('click', (e)=>{
      e.preventDefault();
      const merged = document.createElement('canvas');
      merged.width = W; merged.height = H; const mctx = merged.getContext('2d');
      // Background approximation: draw stars + comets only (CSS layers won't render to canvas here)
      mctx.drawImage(starsCanvas,0,0); mctx.drawImage(cometsCanvas,0,0);
      const link = document.createElement('a');
      link.download = 'universe.png'; link.href = merged.toDataURL(); link.click();
    });

    // Accessibility: reduce motion
    const mediaReduce = matchMedia('(prefers-reduced-motion: reduce)');
    if(mediaReduce.matches){
      // soften warp & animations
      layers.forEach(l=>l.speed*=.4);
      document.querySelector('.nebula').style.animationPlayState='paused';
    }
  </script>
</body>
</html>
